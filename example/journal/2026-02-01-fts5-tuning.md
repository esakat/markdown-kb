---
title: "FTS5 チューニング記録"
status: published
tags:
  - journal
  - sqlite
  - search
  - performance
author: "Hanako Suzuki"
priority: medium
created: "2026-02-01"
updated: "2026-02-05"
---

# FTS5 チューニング記録

## 問題

日本語の検索精度が低く、「アーキテクチャ」で検索しても「アーキ」を含むドキュメントがヒットしない。

## 原因分析

- `unicode61` トークナイザは空白ベースの単語分割
- 日本語には単語間の空白がないため、正しく分割できない
- 部分一致検索が機能しない

## 解決策

`trigram` トークナイザに変更:

```sql
-- Before
CREATE VIRTUAL TABLE documents_fts USING fts5(
  title, body, tokenize='unicode61'
);

-- After
CREATE VIRTUAL TABLE documents_fts USING fts5(
  title, body, tokenize='trigram'
);
```

## ベンチマーク

| ケース | unicode61 | trigram |
|--------|----------|---------|
| "getting started" (英語完全一致) | 2ms | 3ms |
| "アーキテクチャ" (日本語完全一致) | 0 hits | 5ms, 3 hits |
| "検索" (日本語部分一致) | 0 hits | 4ms, 7 hits |
| "Go SQLite" (複合クエリ) | 3ms | 5ms |

### トレードオフ

- インデックスサイズが約 3 倍に増加
- 英語検索の速度がわずかに低下（1-2ms）
- 日本語検索が劇的に改善

## 結論

日本語対応を優先し `trigram` を採用。インデックスサイズの増加は 10,000 ドキュメントでも許容範囲内。

## 関連

- [[architecture/fts5-design]] - FTS5 設計の詳細
- [[guides/search-tips]] - ユーザ向け検索ガイド
